{"version":3,"file":"index.umd.js","sources":["../src/config.js","../src/vue/index.vue"],"sourcesContent":["/**\n * @function config\n * @instance instance\n * @prop {String} className - The default className's for your PIMG(s)\n * @prop {String} placeholderClassName - The default placeholder className's for your image(s)\n * @prop {Function} onError - Determines how errors are handled in the component\n * @prop {Boolean | Object} dataSaver - Choose to use dataSaver mode\n * @prop {String} dataSaver.wrapperClassName - DataSaver wrapper className\n * @prop {String} dataSaver.buttonClassName - DataSaver button className\n */\n\nconst config = (() => {\n\tlet instance\n\n\tconst init = ({\n\t\tbuttonClassName = 'pimg__btn',\n\t\tclassName = 'pimg',\n\t\tdataSaver = false,\n\t\tfetchOnDemand = false,\n\t\terror = null,\n\t\tplaceholderClassName = 'pimg__placeholder',\n\t\twrapperClassName = 'pimg__wrapper'\n\t} = {}) => {\n\t\tif (typeof dataSaver !== 'object' && dataSaver === true) {\n\t\t\tdataSaver = {\n\t\t\t\twrapperClassName,\n\t\t\t\tbuttonClassName\n\t\t\t}\n\t\t} else if (typeof dataSaver === 'object') {\n\t\t\tdataSaver = {\n\t\t\t\twrapperClassName: dataSaver.wrapperClassName || wrapperClassName,\n\t\t\t\tbuttonClassName: dataSaver.buttonClassName || buttonClassName\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tonError: error => {\n\t\t\t\terror = error\n\t\t\t},\n\t\t\tgetClassName: () => {\n\t\t\t\treturn className\n\t\t\t},\n\t\t\tgetButtonClassName: () => {\n\t\t\t\treturn buttonClassName\n\t\t\t},\n\t\t\tgetDataSaver: () => {\n\t\t\t\treturn dataSaver\n\t\t\t},\n\t\t\tgetError: cb => {\n\t\t\t\treturn cb(error)\n\t\t\t},\n\t\t\tgetFetchOnDemand: () => {\n\t\t\t\treturn fetchOnDemand\n\t\t\t},\n\t\t\tgetPlaceholderClassName: () => {\n\t\t\t\treturn placeholderClassName\n\t\t\t},\n\t\t\tgetWrapperClassName: () => {\n\t\t\t\treturn wrapperClassName\n\t\t\t}\n\t\t}\n\t}\n\n\treturn params => (instance ? instance : (instance = init(params)))\n})()\n\nexport default config\n","<template>\n\t<div v-if=\"dataSaverMode\" :class=\"wrapperClassName\">\n\t\t<img\n\t\t  v-if=\"loading\"\n\t\t\tref=\"image\"\n\t\t  :class=\"classNamesCombined\"\n\t\t  :src=\"placeholder||placeholderData\"\n\t\t/>\n\t\t<img\n\t\t  v-else\n\t\t  :class=\"className\"\n\t\t  :src=\"blob\"\n\t\t/>\n\t\t<button :class=\"buttonClassName\" @click=\"fetchImage(src); dataSaverMode = false\">Load image</button>\n\t</div>\n\t<div v-else>\n\t\t<img\n\t\t  v-if=\"loading\"\n\t\t\tref=\"image\"\n\t\t  :class=\"classNamesCombined\"\n\t\t  :src=\"placeholder||placeholderData\"\n\t\t/>\n\t\t<img\n\t\t  v-else\n\t\t  :class=\"className\"\n\t\t  :src=\"blob\"\n\t\t/>\n\t</div>\n</template>\n\n<script>\nimport config from '../config.js'\n\nexport default {\n\tname: 'pimg',\n\n\tdata: () => ({\n\t\tblob: null,\n\t\tbuttonClassName: 'pimg__btn',\n\t\tclassName: 'pimg',\n\t\tclassNamesCombined: 'pimg pimg__btn',\n\t\tdataSaverMode: false,\n\t\tdelayed: false,\n\t\tloading: true,\n\t\tplaceholderClassName: 'pimg__placeholder',\n\t\tplaceholderData: null,\n\t\twrapperClassName: 'pimg__wrapper'\n\t}),\n\n\tprops: ['dataSaver', 'fetchOnDemand', 'placeholder', 'src'],\n\n\tmethods: {\n\t\tdelayFetchingImage(delayed) {\n\t\t\tthis.delayed = delayed\n\t\t},\n\t\tfetchImage() {\n\t\t\tfetch(this.src)\n\t\t\t\t.then(res => res.blob())\n\t\t\t\t.then(res => {\n\t\t\t\t\tlet blob = URL.createObjectURL(res)\n\n\t\t\t\t\tthis.blob = blob\n\t\t\t\t\tthis.loading = false\n\t\t\t\t})\n\t\t},\n\t\t_fetchOnDemand(src) {\n\t\t\ttry {\n\t\t\t\tlet observer = new IntersectionObserver(entries => {\n\t\t\t\t\tlet image = entries[0]\n\n\t\t\t\t\tif (image.isIntersecting) {\n\t\t\t\t\t\tthis.fetchImage(this.src)\n\t\t\t\t\t\tthis.delayFetchingImage(false)\n\t\t\t\t\t\tobserver.disconnect()\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tobserver.observe(this.$refs.image)\n\t\t\t} catch (_) {\n\t\t\t\t// Fail gracefully\n\t\t\t\tconsole.warn('fetchOnDemand not supported on this browser', _)\n\t\t\t\tthis.fetchImage(this.src)\n\t\t\t\tthis.delayFetchingImage(false)\n\t\t\t}\n\t\t}\n\t},\n\n\tmounted() {\n\t\tconst {\n\t\t\tgetButtonClassName,\n\t\t\tgetClassName,\n\t\t\tgetDataSaver,\n\t\t\tgetFetchOnDemand,\n\t\t\tgetPlaceholderClassName,\n\t\t\tgetWrapperClassName\n\t\t} = config()\n\n\t\tthis.buttonClassName = getButtonClassName()\n\t\tthis.className = getClassName()\n\t\tthis.dataSaverMode = typeof this.dataSaver !== 'undefined' || getDataSaver()\n\t\tthis.placeholderClassName = getPlaceholderClassName()\n\t\tthis.wrapperClassName = getWrapperClassName()\n\t\tthis.classNamesCombined = this.className + ' ' + this.placeholderClassName\n\n\t\tif (this.src && this.src.includes('cloudinary')) {\n\t\t\tthis.placeholderData =\n\t\t\t\tthis.placeholder ||\n\t\t\t\tthis.src.replace('/upload/', '/upload/c_thumb,w_30/')\n\t\t}\n\n\t\tif (typeof this.dataSaver !== 'undefined' || getDataSaver()) {\n\t\t\tthis.delayFetchingImage(true)\n\t\t} else if (\n\t\t\ttypeof this.fetchOnDemand !== 'undefined' ||\n\t\t\tgetFetchOnDemand()\n\t\t) {\n\t\t\tthis.delayFetchingImage(true)\n\t\t\tthis._fetchOnDemand(this.src)\n\t\t} else {\n\t\t\tthis.fetchImage(this.src)\n\t\t}\n\t}\n}\n\nexport { config }\n</script>\n"],"names":["config","instance","init","buttonClassName","className","dataSaver","fetchOnDemand","error","placeholderClassName","wrapperClassName","cb","params"],"mappings":";;;;;;;;;;;;;;;;;;;AAWA,IAAMA,SAAU,YAAM;KACjBC,iBAAJ;;KAEMC,OAAO,SAAPA,IAAO,GAQF;iFAAP,EAAO;kCAPVC,eAOU;MAPVA,eAOU,wCAPQ,WAOR;4BANVC,SAMU;MANVA,SAMU,kCANE,MAMF;4BALVC,SAKU;MALVA,SAKU,kCALE,KAKF;gCAJVC,aAIU;MAJVA,aAIU,sCAJM,KAIN;wBAHVC,KAGU;MAHVA,KAGU,8BAHF,IAGE;mCAFVC,oBAEU;MAFVA,oBAEU,yCAFa,mBAEb;mCADVC,gBACU;MADVA,gBACU,yCADS,eACT;;MACN,QAAOJ,SAAP,yCAAOA,SAAP,OAAqB,QAArB,IAAiCA,cAAc,IAAnD,EAAyD;eAC5C;sCAAA;;IAAZ;GADD,MAKO,IAAI,QAAOA,SAAP,yCAAOA,SAAP,OAAqB,QAAzB,EAAmC;eAC7B;sBACOA,UAAUI,gBAAV,IAA8BA,gBADrC;qBAEMJ,UAAUF,eAAV,IAA6BA;IAF/C;;;SAMM;YACG,wBAAS;YACTI,KAAR;IAFK;iBAIQ,wBAAM;WACZH,SAAP;IALK;uBAOc,8BAAM;WAClBD,eAAP;IARK;iBAUQ,wBAAM;WACZE,SAAP;IAXK;aAaI,sBAAM;WACRK,GAAGH,KAAH,CAAP;IAdK;qBAgBY,4BAAM;WAChBD,aAAP;IAjBK;4BAmBmB,mCAAM;WACvBE,oBAAP;IApBK;wBAsBe,+BAAM;WACnBC,gBAAP;;GAvBF;EArBD;;QAiDO;SAAWR,WAAWA,QAAX,GAAuBA,WAAWC,KAAKS,MAAL,CAA7C;EAAP;CApDc,EAAf;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACoBA,AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAAA;;;;AA9BY,2BAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}
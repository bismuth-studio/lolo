!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("whatwg-fetch")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","whatwg-fetch"],t):t(e.pimg={},e.react,e.PropTypes)}(this,function(e,t,n){"use strict";var b="default"in t?t.default:t;n=n&&n.hasOwnProperty("default")?n.default:n;var r,h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},O=(r=void 0,function(e){return r||(r=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.buttonClassName,n=void 0===t?"pimg__btn":t,r=e.className,a=void 0===r?"pimg":r,o=e.dataSaver,c=void 0!==o&&o,i=e.fetchOnDemand,s=void 0!==i&&i,l=e.error,u=void 0===l?null:l,f=e.placeholderClassName,p=void 0===f?"pimg__placeholder":f,d=e.wrapperClassName,m=void 0===d?"pimg__wrapper":d;return"object"!==(void 0===c?"undefined":h(c))&&!0===c?c={wrapperClassName:m,buttonClassName:n}:"object"===(void 0===c?"undefined":h(c))&&(c={wrapperClassName:c.wrapperClassName||m,buttonClassName:c.buttonClassName||n}),{onError:function(e){e=e},getClassName:function(){return a},getButtonClassName:function(){return n},getDataSaver:function(){return c},getError:function(e){return e(u)},getFetchOnDemand:function(){return s},getPlaceholderClassName:function(){return p},getWrapperClassName:function(){return m}}}(e))}),o=function(e){function c(){var e,t,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);for(var n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=r=i(this,(e=c.__proto__||Object.getPrototypeOf(c)).call.apply(e,[this].concat(a)))).state={blob:null,loading:!0,delayed:!1,placeholder:null},r.setBlob=function(e){return r.setState({blob:e})},r.setPlaceholder=function(e){return r.setState({placeholder:e})},r.setLoading=function(e){return r.setState({loading:e})},r.delayFetchingImage=function(e){return r.setState({delayed:e})},r.fetchImage=function(e){fetch(e).then(function(e){return e.blob()}).then(function(e){r.setBlob(URL.createObjectURL(e)),r.setLoading(!1),r.delayFetchingImage(!1)})},r.image=function(){return r.imgElement},r.fetchOnDemand=function(t){try{var n=new IntersectionObserver(function(e){e[0].isIntersecting&&(r.fetchImage(t),r.delayFetchingImage(!1),n.disconnect())});n.observe(r.image())}catch(e){console.warn("fetchOnDemand not supported on this browser"),r.fetchImage(t),r.delayFetchingImage(!1)}},i(r,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,t.Component),a(c,[{key:"componentDidMount",value:function(){var e=this.props,t=e.dataSaver,n=e.src,r=e.fetchOnDemand,a=(e.placeholder,O()),o=a.getDataSaver,c=a.getFetchOnDemand;if(n&&n.includes("cloudinary")){var i=i||n.replace("/upload/","/upload/c_thumb,w_30/");this.setPlaceholder(i)}t||o()?this.delayFetchingImage(!0):r||c()?(this.setLoading(!0),this.fetchOnDemand(n)):this.fetchImage(n)}},{key:"componentWillReceiveProps",value:function(e){var t=e.dataSaver,n=e.fetchOnDemand,r=e.src,a=O(),o=a.getDataSaver,c=a.getFetchOnDemand;t||o()?this.delayFetchingImage(!0):n||c()?(this.setLoading(!0),this.fetchOnDemand(r)):this.fetchImage(r)}},{key:"render",value:function(){var t=this,e=this.props,n=e.className,r=e.dataSaver,a=(e.fetchOnDemand,e.placeholderClassName),o=(e.src,e.placeholder),c=function(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["className","dataSaver","fetchOnDemand","placeholderClassName","src","placeholder"]),i=this.state,s=i.blob,l=i.delayed,u=i.loading,f=O(),p=f.getButtonClassName,d=f.getClassName,m=f.getDataSaver,h=f.getPlaceholderClassName,g=f.getWrapperClassName,y=n?n+" "+(a||h()):a?(n||d())+" "+a:d()+" "+h();return(r||m())&&u||l?b.createElement("div",{className:g()},b.createElement("img",v({className:y,src:o||this.state.placeholder,ref:function(e){return t.imgElement=e}},c)),b.createElement("button",{className:p(),onClick:function(){return t.fetchImage(t.props.src)}},"Load image")):u?b.createElement("img",v({className:y,src:o||this.state.placeholder,ref:function(e){return t.imgElement=e}},c)):b.createElement("img",v({className:n||d(),src:s},c))}}]),c}();o.propTypes={src:n.string.isRequired},e.default=o,e.config=O,Object.defineProperty(e,"__esModule",{value:!0})});